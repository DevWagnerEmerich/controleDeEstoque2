<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockControl Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="css/style.css?v=1.3">
    <link rel="stylesheet" href="css/modal_styles.css?v=1.2">
    <script type="module" src="js/main.js?v=1.3"></script>
    <script type="module" src="js/simulation.js?v=1.3"></script>
    <script type="module" src="js/purchase-orders.js?v=1.3"></script>
</head>
<body class="antialiased">

    <div id="login-screen">
        <div class="login-panel-left">
            <div class="login-card">
                <div class="login-logo">
                    <i data-feather="box"></i>
                    <h1>StockControl Pro</h1>
                </div>
                <p class="text-secondary mb-6">Por favor, insira as suas credenciais.</p>
                <form id="login-form">
                    <input type="text" id="username" placeholder="Utilizador" class="form-input" required>
                    <div id="toggle-password-btn" class="password-wrapper">
                        <input type="password" id="password" placeholder="Palavra-passe" class="form-input" required>
                        <i id="toggle-password" data-feather="eye-off" class="password-toggle-icon"></i>
                    </div>
                    <p id="login-error" class="text-red-500 text-sm h-4"></p>
                    <button type="submit" class="btn">Entrar</button>
                </form>
            </div>
        </div>
        <div class="login-panel-right"></div>
    </div>
    
    <input type="file" id="xml-upload-main" class="hidden" accept=".xml">
    <input type="file" id="po-xml-upload" class="hidden" accept=".xml" multiple>
    
    <div id="app-container" class="hidden">
        <!-- Desktop Top Navigation (hidden on mobile) -->
        <header class="top-nav desktop-only">
            <div class="nav-container">
                <div class="nav-left">
                    <div class="nav-logo">
                        <i data-feather="box"></i>
                        <span>StockControl Pro</span>
                    </div>
                    <nav class="nav-links">
                        <a href="#" id="desktop-nav-dashboard" class="nav-link active"><span>Dashboard</span></a>
                                                <div class="nav-item-wrapper">
                            <a href="#" id="desktop-nav-operations" class="nav-link">
                                <span>Operações</span>
                                <i data-feather="chevron-down" class="nav-chevron"></i>
                            </a>
                            <div id="operations-dropdown" class="dropdown-menu hidden">
                                <a href="#" id="dropdown-import-op-btn" class="dropdown-item">
                                    <i data-feather="plus-circle"></i>
                                    <span>Importar NF-e</span>
                                </a>
                                <a href="#" id="dropdown-simulate-op-btn" class="dropdown-item">
                                    <i data-feather="clipboard"></i>
                                    <span>Simular Operação</span>
                                </a>
                                <a href="#" id="dropdown-history-op-btn" class="dropdown-item">
                                    <i data-feather="clock"></i>
                                    <span>Histórico de Operações</span>
                                </a>
                            </div>
                        </div>
                        <a href="#" id="desktop-reports-btn" class="nav-link"><span>Relatórios</span></a>
                        <a href="#" id="desktop-nav-purchase-orders" class="nav-link"><span>Ordens de Compra</span></a>
                    </nav>
                </div>
                <div class="nav-right">
                    <div class="nav-actions">
                        <button id="desktop-add-item-btn" class="nav-action-button primary">
                            <i data-feather="plus"></i>
                            <span>Adicionar Item</span>
                        </button>
                        <button id="desktop-suppliers-btn" class="nav-action-button">
                            <i data-feather="truck"></i>
                        </button>
                        <button id="desktop-users-btn" class="nav-action-button">
                            <i data-feather="users"></i>
                        </button>
                    </div>
                    <div class="nav-user">
                        <span id="desktop-username"></span>
                        <button id="desktop-logout-btn" class="nav-action-button">
                            <i data-feather="log-out"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile-First Header (hidden on desktop) -->
        <header class="mobile-header mobile-only">
            <div class="header-content">
                <h1 id="header-title">Dashboard</h1>
                <div class="header-actions">
                    <button id="add-item-btn-header" class="header-action-btn">
                        <i data-feather="plus"></i>
                    </button>
                </div>
            </div>
        </header>

        <div id="main-content">
            <main class="container">
                <!-- Dashboard View -->
                <div id="view-dashboard" class="main-view">
                    <section id="dashboard-stats"></section>
                    <div class="controls-card">
                        <div class="search-wrapper">
                            <i data-feather="search"></i>
                            <input type="text" id="searchInput" class="form-input" placeholder="Procurar item...">
                        </div>
                        <div class="filters-wrapper">
                            <select id="sortSelect" class="form-select">
                                <option value="name-asc">A-Z</option>
                                <option value="name-desc">Z-A</option>
                                <option value="qty-desc">Maior Qtd.</option>
                                <option value="qty-asc">Menor Qtd.</option>
                            </select>
                            <select id="filterSelect" class="form-select">
                                <option value="all">Todos</option>
                                <option value="ok">OK</option>
                                <option value="low">Baixo</option>
                                <option value="critical">Crítico</option>
                            </select>
                            <button id="menu-clear-data" class="btn btn-secondary btn-danger-outline btn-sm">
                                <i data-feather="trash-2" class="mr-2"></i>
                                <span>Limpar Dados</span>
                            </button>
                        </div>
                    </div>
                    <div id="items-grid-container" class="items-grid"></div>
                    <div id="empty-state" class="hidden text-center py-16"><i data-feather="package" class="text-5xl text-gray-300 mb-4"></i><h3 class="text-xl font-semibold text-gray-700">Nenhum item encontrado</h3><p class="text-secondary">Adicione um novo item para começar.</p></div>
                </div>

                <!-- Operations Hub Modal -->
                <div id="operations-hub-modal" class="modal-backdrop">
                    <div class="modal-content" style="max-width: 450px;">
                        <div class="modal-header">
                            <h2>Central de Operações</h2>
                            <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
                        </div>
                        <div class="modal-body">
                            <div class="operations-hub">
                                <div class="hub-card">
                                    <i data-feather="plus-circle" class="hub-icon"></i>
                                    <h3>Importar NF-e</h3>
                                    <p>Extraia itens de uma Nota Fiscal (XML).</p>
                                    <button id="hub-import-op-btn" class="btn btn-secondary">Importar</button>
                                </div>
                                <div class="hub-card">
                                    <i data-feather="clipboard" class="hub-icon"></i>
                                    <h3>Simular Operação</h3>
                                    <p>Crie uma operação do zero com qualquer item.</p>
                                    <button id="hub-simulate-op-btn" class="btn btn-secondary">Simular</button>
                                </div>
                                <div class="hub-card">
                                    <i data-feather="clock" class="hub-icon"></i>
                                    <h3>Histórico</h3>
                                    <p>Veja todas as operações passadas.</p>
                                    <button id="hub-history-op-btn" class="btn btn-secondary">Ver Histórico</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports View -->
                <div id="view-reports" class="main-view hidden">
                    <!-- O conteúdo dos relatórios será renderizado aqui ou em um modal -->
                </div>

                <!-- Menu View -->
                <div id="view-menu" class="main-view hidden">
                    <div class="menu-list">
                        <a href="#" id="menu-suppliers" class="menu-item">
                            <i data-feather="truck"></i>
                            <span>Gerir Fornecedores</span>
                            <i data-feather="chevron-right" class="chevron"></i>
                        </a>
                        <a href="#" id="menu-users" class="menu-item">
                            <i data-feather="users"></i>
                            <span>Gerir Utilizadores</span>
                            <i data-feather="chevron-right" class="chevron"></i>
                        </a>
                        <a href="#" id="menu-packlist" class="menu-item">
                            <i data-feather="file-text"></i>
                            <span>Gerar Packing List</span>
                            <i data-feather="chevron-right" class="chevron"></i>
                        </a>
                        <a href="#" id="menu-invoice" class="menu-item">
                            <i data-feather="file-text"></i>
                            <span>Gerar Invoice</span>
                            <i data-feather="chevron-right" class="chevron"></i>
                        </a>
                        <a href="#" id="menu-purchase-orders" class="menu-item">
                            <i data-feather="shopping-cart"></i>
                            <span>Ordens de Compra</span>
                            <i data-feather="chevron-right" class="chevron"></i>
                        </a>
                    </div>
                    <div class="user-info-card">
                        <p>Utilizador: <span id="menu-username"></span></p>
                        <button id="logout-btn-menu" class="btn btn-danger">Terminar Sessão</button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Bottom Navigation Bar -->
        <nav class="bottom-nav">
            <a href="#" id="nav-dashboard" class="nav-item active">
                <i data-feather="grid"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" id="nav-operations" class="nav-item">
                <i data-feather="settings"></i>
                <span>Operações</span>
            </a>
            <a href="#" id="nav-reports" class="nav-item">
                <i data-feather="pie-chart"></i>
                <span>Relatórios</span>
            </a>
            <a href="#" id="nav-menu" class="nav-item">
                <i data-feather="menu"></i>
                <span>Menu</span>
            </a>
        </nav>
    </div>

    <!-- Modals (mantidos para funcionalidades específicas) -->
    <div id="reports-modal" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Relatórios e Histórico</h2>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div id="reports-tab-nav" class="report-tab-nav">
                <button data-tab="overview" class="report-tab active">Visão Geral</button>
                <button data-tab="products" class="report-tab">Produtos</button>
                <button data-tab="history" class="report-tab">Histórico</button>
            </div>
            <div class="modal-body">
                <div id="tab-overview" class="report-tab-content active">
                    <div class="charts-grid">
                        <div class="report-card">
                            <h3 class="report-card-title">Valor do Stock (Custo)</h3>
                            <div class="chart-container">
                                <canvas id="valueChart"></canvas>
                            </div>
                        </div>
                        <div class="report-card">
                            <h3 class="report-card-title">Estado do Stock</h3>
                            <div class="chart-container">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>
                     <div class="report-card recent-movements">
                        <h3 class="report-card-title">Movimentações Recentes</h3>
                        <div id="reports-movements-history"></div>
                    </div>
                </div>
                <div id="tab-products" class="report-tab-content">
                    <div class="report-controls">
                        <select id="reports-period-filter" class="form-select">
                            <option value="7">Últimos 7 dias</option>
                            <option value="30" selected>Últimos 30 dias</option>
                            <option value="90">Últimos 90 dias</option>
                            <option value="all">Todo o período</option>
                        </select>
                    </div>
                    <div class="charts-grid">
                        <div class="report-card">
                            <h3 class="report-card-title">Itens Mais Vendidos</h3>
                            <div id="top-selling-items"></div>
                        </div>
                        <div class="report-card">
                            <h3 class="report-card-title">Itens Menos Vendidos</h3>
                            <div id="least-selling-items"></div>
                        </div>
                    </div>
                </div>
                 <div id="tab-history" class="report-tab-content">
                    <div class="report-controls">
                        <h3 class="report-card-title">Rastro de Movimentações</h3>
                        <input type="date" id="daily-movements-date-picker" class="form-input">
                    </div>
                    <div id="daily-movements-list" class="report-card"></div>
                </div>
            </div>
        </div>
    </div>
            <div id="operations-history-modal" class="modal-backdrop">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Histórico de Operações</h2>
                        <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
                    </div>
                    <div id="operations-history-list-container" class="modal-body"></div>
                </div>
            </div>
    
            <div id="purchase-orders-modal" class="modal-backdrop">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Ordens de Compra Pendentes</h2>
                        <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
                    </div>
                    <div id="purchase-orders-list-container" class="modal-body"></div>
                </div>
            </div>    <div id="operation-modal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <div>
                    <h2 id="operation-modal-title">Nova Operação de Saída</h2>
                    <p id="operation-id" class="text-sm text-secondary"></p>
                </div>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div class="operation-layout">
                <div class="available-items-panel">
                    <h3 class="panel-title">Produtos Disponíveis</h3>
                    <div id="operation-available-items" class="panel-body"></div>
                </div>
                <div class="selected-items-panel">
                    <h3 class="panel-title">Itens na Operação</h3>
                    <div id="operation-selected-items" class="panel-body"></div>
                    <div class="panel-footer">
                        <div id="operation-summary" class="summary-details"></div>
                        <button id="save-operation-btn" class="btn btn-primary" style="width: 100%;"><i data-feather="save" style="margin-right: 0.5rem;"></i>Salvar Operação</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="simulation-modal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <div>
                    <h2 id="simulation-modal-title">Simulação de Operação</h2>
                    <p id="simulation-id" class="text-sm text-secondary"></p>
                </div>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div class="operation-layout">
                <div class="available-items-panel">
                    <div class="panel-controls">
                        <div class="search-wrapper">
                            <i data-feather="search"></i>
                            <input type="text" id="sim-search-input" class="form-input" placeholder="Buscar produto..." oninput="renderSimulationAvailableItems()">
                        </div>
                        <div class="panel-actions">
                             <div class="checkbox-wrapper">
                                <input type="checkbox" id="sim-select-all-chk">
                                <label for="sim-select-all-chk">Todos</label>
                            </div>
                            <button id="sim-add-new-item-btn" class="btn btn-secondary btn-sm">Novo Item</button>
                        </div>
                    </div>
                    <div id="sim-available-items" class="panel-body"></div>
                </div>
                <div class="selected-items-panel">
                    <h3 class="panel-title">Itens na Simulação</h3>
                    <div id="sim-selected-items" class="panel-body"></div>
                    <div class="panel-footer">
                        <div id="sim-summary" class="summary-details"></div>
                        <div class="sim-actions">
                            <button id="sim-preview-invoice-btn" class="btn btn-secondary btn-sm"><i data-feather="eye"></i> Preview</button>
                            <button id="sim-save-draft-btn" class="btn btn-secondary btn-sm"><i data-feather="save"></i> Rascunho</button>
                            <button id="sim-finalize-btn" class="btn btn-primary btn-sm"><i data-feather="check-circle"></i> Criar Ordem de Compra</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="confirm-modal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 450px; text-align: center;">
            <div class="modal-body" style="padding: 2rem;">
                <i data-feather="alert-triangle" style="width: 48px; height: 48px; margin: 0 auto 1rem; color: #F97316;"></i>
                <h3 id="confirm-modal-title" style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Tem a certeza?</h3>
                <p id="confirm-modal-text" class="text-secondary">Esta ação não pode ser desfeita.</p>
            </div>
            <div class="modal-footer" style="background-color: var(--color-card);">
                <button id="confirm-modal-cancel-btn" type="button" class="btn btn-secondary">Cancelar</button>
                <button id="confirm-modal-btn" type="button" class="btn btn-danger">Confirmar</button>
            </div>
        </div>
    </div>
    <div id="users-modal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Gerir Utilizadores</h2>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div class="modal-body" style="display: flex; padding: 0; flex-grow: 1;">
                <div class="users-list-panel">
                    <div id="users-list" class="panel-body" style="padding: 1.5rem;"></div>
                </div>
                <div class="user-form-panel">
                    <form id="user-form">
                        <input type="hidden" id="userId">
                        <h3 id="user-form-title">Adicionar Novo Utilizador</h3>
                        <div class="form-grid">
                            <div><label for="formUsername">Nome de Utilizador</label><input type="text" id="formUsername" required class="form-input"></div>
                            <div><label for="formPassword">Palavra-passe</label><input type="password" id="formPassword" class="form-input" placeholder="Deixe em branco para não alterar"></div>
                        </div>
                        <div id="permissions-wrapper">
                            <h4>Permissões</h4>
                            <div id="permissions-container" class="permissions-grid">
                                <label><input type="checkbox" id="perm-add"><span>Adicionar Itens</span></label>
                                <label><input type="checkbox" id="perm-edit"><span>Editar Itens</span></label>
                                <label><input type="checkbox" id="perm-delete"><span>Excluir Itens</span></label>
                                <label><input type="checkbox" id="perm-operation"><span>Criar Operações</span></label>
                                <label><input type="checkbox" id="perm-import"><span>Importar NF-e</span></label>
                                <label><input type="checkbox" id="perm-reports"><span>Ver Relatórios</span></label>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="reset-user-form-btn" class="btn btn-secondary">Limpar</button>
                            <button type="submit" class="btn btn-primary">Salvar Utilizador</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="item-details-modal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div>
                    <h2 id="details-item-name"></h2>
                    <p id="details-item-name-en" class="text-secondary"></p>
                </div>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div class="modal-body">
                <div class="item-details-layout">
                    <div class="item-details-image-panel">
                        <img id="details-item-image" src="" alt="Imagem do item">
                        <div class="item-details-pricing">
                            <div class="price-row">
                                <span>Preço de Custo:</span>
                                <span id="details-item-cost" class="font-bold"></span>
                            </div>
                            <div class="price-row">
                                <span>Preço de Venda:</span>
                                <span id="details-item-sale" class="font-bold"></span>
                            </div>
                            <div class="price-row margin">
                                <span>Margem de Lucro:</span>
                                <span id="details-item-margin" class="font-bold"></span>
                            </div>
                        </div>
                    </div>
                    <div class="item-details-info-panel">
                        <div>
                            <h4 class="info-title">Descrição</h4>
                            <p id="details-item-description"></p>
                        </div>
                        <div class="info-grid">
                            <div>
                                <h4 class="info-title" id="details-package-type-label"></h4>
                                <p id="details-item-boxes" class="info-value"></p>
                            </div>
                            <div>
                                <h4 class="info-title">Total de Unidades</h4>
                                <p id="details-item-quantity" class="info-value"></p>
                            </div>
                            <div>
                                <h4 class="info-title">Cód/SKU</h4>
                                <p id="details-item-code" class="info-value"></p>
                            </div>
                            <div>
                                <h4 class="info-title">NCM</h4>
                                <p id="details-item-ncm" class="info-value"></p>
                            </div>
                            <div>
                                <h4 class="info-title">QTY UNIT</h4>
                                <p id="details-item-qty-unit" class="info-value"></p>
                            </div>
                        </div>
                        <div>
                            <h4 class="info-title">Fornecedor</h4>
                            <p id="details-item-supplier"></p>
                        </div>
                    </div>
                </div>
                <div class="item-details-movements">
                    <h4 class="info-title">Movimentações Recentes</h4>
                    <div id="details-item-history"></div>
                </div>
            </div>
        </div>
    </div>
        <div id="item-modal" class="modal-backdrop">
        <form id="item-form" class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="item-modal-title">Adicionar Novo Item</h2>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div class="modal-body" style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
                <div class="image-upload-area">
                    <label>Imagem</label>
                    <div class="image-uploader">
                        <img id="imagePreview" src="#" alt="Pré-visualização" class="hidden">
                        <div id="imagePlaceholder" class="image-placeholder">
                            <i data-feather="image"></i>
                            <p>JPG, PNG, GIF</p>
                        </div>
                        <label for="itemImageInput" class="upload-button">Carregar ficheiro</label>
                        <input id="itemImageInput" name="itemImage" type="file" class="sr-only" accept="image/*">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div><label for="itemName">Nome do Item (PT)</label><input type="text" id="itemName" required class="form-input"></div>
                    <div><label for="itemNameEn">Nome do Item (EN)</label><input type="text" id="itemNameEn" class="form-input"></div>
                    <div><label for="itemCode">Código/SKU</label><input type="text" id="itemCode" class="form-input"></div>
                    <div><label for="itemNcm">NCM</label><input type="text" id="itemNcm" class="form-input"></div>
                    <div style="grid-column: 1 / -1;"><label for="itemDescription">Descrição</label><textarea id="itemDescription" class="form-input" rows="3"></textarea></div>
                    <div><label for="itemCostPrice">Preço de Custo</label><input type="number" id="itemCostPrice" class="form-input" step="0.01"></div>
                    <div><label for="itemSalePrice">Preço de Venda</label><input type="number" id="itemSalePrice" class="form-input" step="0.01"></div>
                    <div><label for="quantityInBoxes">Qtd. em Stock (Embalagens)</label><input type="number" id="quantityInBoxes" class="form-input"></div>
                    <div><label for="itemMinQuantity">Stock Mínimo (Unidades)</label><input type="number" id="itemMinQuantity" class="form-input"></div>
                    <div><label for="packageType">Tipo de Embalagem</label><select id="packageType" class="form-select"><option value="caixa">Caixa</option><option value="fardo">Fardo</option></select></div>
                    <div><label for="unitsPerPackage">Unidades por Embalagem</label><input type="number" id="unitsPerPackage" class="form-input"></div>
                    <div><label for="unitMeasureValue">Peso/Volume por Unidade</label><input type="number" id="unitMeasureValue" class="form-input" step="0.01"></div>
                    <div><label for="unitMeasureType">Unidade de Medida</label><select id="unitMeasureType" class="form-select form-select-small"><option value="g">g</option><option value="kg">kg</option><option value="ml">ml</option><option value="l">L</option></select></div>
                    <div style="grid-column: 1 / -1;"><label for="itemSupplier">Fornecedor</label><select id="itemSupplier" class="form-select"></select></div>
                </div>
            </div>
            <div class="modal-footer">
                <input type="hidden" id="itemId">
                <button type="button" class="btn btn-secondary closeModalBtn">Cancelar</button>
                <button type="submit" class="btn btn-primary">Salvar Item</button>
            </div>
        </form>
    </div>
    <div id="sim-add-item-modal" class="modal-backdrop">
        <form id="sim-item-form" class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="sim-item-modal-title">Adicionar Item à Simulação</h2>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div class="modal-body" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div style="grid-column: 1 / -1;"><label for="simItemName">Nome do Item (PT)</label><input type="text" id="simItemName" class="form-input"></div>
                <div style="grid-column: 1 / -1;"><label for="simItemNameEn">Nome do Item (EN)</label><input type="text" id="simItemNameEn" class="form-input"></div>
                <div><label for="simItemCode">Código/SKU</label><input type="text" id="simItemCode" class="form-input"></div>
                <div><label for="simItemNcm">NCM</label><input type="text" id="simItemNcm" class="form-input" maxlength="8"></div>
                <div style="grid-column: 1 / -1;"><label for="simItemDescription">Descrição</label><textarea id="simItemDescription" class="form-input" rows="2"></textarea></div>
                <div><label for="simItemCostPrice">Preço de Custo</label><input type="number" id="simItemCostPrice" class="form-input" step="0.01"></div>
                <div><label for="simUnitsPerPackage">Unidades por Embalagem</label><input type="number" id="simUnitsPerPackage" class="form-input" value="1"></div>
                <div><label for="simUnitMeasureValue">Peso/Volume por Unidade</label><input type="number" id="simUnitMeasureValue" class="form-input" step="0.01" value="1"></div>
                <div>
                    <label for="simUnitMeasureType">Unidade de Medida</label>
                    <select id="simUnitMeasureType" class="form-select form-select-small">
                        <option value="un">un</option>
                        <option value="g">g</option>
                        <option value="kg">kg</option>
                        <option value="ml">ml</option>
                        <option value="l">L</option>
                    </select>
                </div>
                <div style="grid-column: 1 / -1;"><label for="simItemSupplier">Fornecedor</label><select id="simItemSupplier" class="form-select"></select></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary closeModalBtn">Cancelar</button>
                <button type="submit" class="btn btn-primary">Adicionar Item</button>
            </div>
        </form>
    </div>
    <div id="suppliers-modal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Gerir Fornecedores</h2>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div class="modal-body" style="display: flex; padding: 0; flex-grow: 1;">
                <div class="suppliers-list-panel">
                    <div id="suppliers-list" class="panel-body" style="padding: 1.5rem;">
                        <!-- Lista de fornecedores renderizada aqui -->
                    </div>
                </div>
                <div class="supplier-form-panel">
                    <form id="supplier-form">
                        <input type="hidden" id="supplierId">
                        <h3 id="supplier-form-title">Adicionar Novo Fornecedor</h3>
                        <div class="form-grid">
                            <div><label for="supplierName">Nome do Fornecedor</label><input type="text" id="supplierName" required class="form-input"></div>
                            <div><label for="supplierCnpj">NIF</label><input type="text" id="supplierCnpj" class="form-input" maxlength="18"></div>
                            <div class="full-width"><label for="supplierAddress">Morada</label><input type="text" id="supplierAddress" class="form-input"></div>
                            <div><label for="supplierFda">Registo FDA</label><input type="text" id="supplierFda" class="form-input"></div>
                            <div><label for="supplierEmail">E-mail</label><input type="email" id="supplierEmail" class="form-input"></div>
                            <div><label for="supplierSalesperson">Nome do Vendedor</label><input type="text" id="supplierSalesperson" class="form-input"></div>
                            <div><label for="supplierPhone">Telefone</label><input type="text" id="supplierPhone" class="form-input"></div>
                        </div>
                        <div class="form-actions">
                            <button type="button" id="reset-supplier-form-btn" class="btn btn-secondary">Limpar</button>
                            <button type="submit" class="btn btn-primary">Salvar Fornecedor</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="stock-modal" class="modal-backdrop">
        <form id="stock-form" class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2 id="stock-modal-title">Movimentar Stock</h2>
                <button type="button" class="close-btn closeModalBtn"><i data-feather="x"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="stockItemId">
                <div>
                    <label>Tipo de Movimento</label>
                    <input type="text" id="movementType" readonly class="form-input" value="Entrada (Ajuste Manual)" style="background-color: var(--border-color);">
                </div>
                <div>
                    <label for="movementQuantity" id="movement-quantity-label">Quantidade a Adicionar</label>
                    <input type="number" id="movementQuantity" min="1" required class="form-input">
                </div>
                <div>
                    <label for="movementReason">Motivo/Observação</label>
                    <input type="text" id="movementReason" class="form-input" placeholder="Ex: Contagem de inventário, devolução">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary closeModalBtn">Cancelar</button>
                <button type="submit" class="btn btn-primary">Confirmar Entrada</button>
            </div>
        </form>
    </div>
    <div id="notification-container" class="fixed bottom-24 md:bottom-5 right-5 z-50 space-y-3"></div>
    <div id="unit-confirm-modal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Confirmar Unidades de Medida</h2>
                <button type="button" id="unit-confirm-close-btn" class="close-btn"><i data-feather="x"></i></button>
            </div>
            <div class="modal-body">
                <p class="text-secondary" style="margin-bottom: 1rem;">Confirme a unidade de medida de cada item para garantir a precisão dos cálculos.</p>
                <div id="unit-confirm-product-list" class="space-y-3 p-4 bg-gray-50 rounded-lg border"></div>
            </div>
            <div class="modal-footer">
                <button id="unit-confirm-cancel-btn" type="button" class="btn btn-secondary">Cancelar</button>
                <button id="unit-confirm-continue-btn" type="button" class="btn btn-primary">Confirmar e Continuar</button>
            </div>
        </div>
    </div>
    <div id="extraction-menu-modal" class="modal-backdrop">
        <div class="modal-content" style="max-width: 450px; text-align: center;">
            <div class="modal-body" style="padding: 2rem;">
                <i data-feather="check-circle" style="width: 48px; height: 48px; margin: 0 auto 1rem; color: #22C55E;"></i>
                <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Nota Fiscal Processada!</h3>
                <p class="text-secondary">Os itens foram extraídos. O que você gostaria de fazer agora?</p>
                <div id="extraction-summary" class="extraction-summary"></div>
            </div>
            <div class="modal-footer" style="flex-direction: column; background-color: var(--color-card);">
                <button id="menu-action-save-stock" class="btn btn-secondary"><i data-feather="archive" style="margin-right: 0.5rem;"></i>Guardar itens no estoque</button>
                <button id="menu-action-load-another" class="btn btn-secondary"><i data-feather="plus-circle" style="margin-right: 0.5rem;"></i>Carregar outra nota</button>
                <button id="menu-action-perform-op" class="btn btn-primary"><i data-feather="settings" style="margin-right: 0.5rem;"></i>Realizar operação</button>
                <button id="menu-action-cancel" class="btn btn-danger closeModalBtn"><i data-feather="x-circle" style="margin-right: 0.5rem;"></i>Cancelar</button>
            </div>
        </div>
    </div>

</body>
</html>
